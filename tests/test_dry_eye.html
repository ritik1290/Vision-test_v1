<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dry Eye Assessment (OSDI) - Vision Health Portal</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 2rem;
            border-radius: 16px;
            box-shadow: var(--shadow);
        }

        .question-card {
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #eee;
        }

        .options-row {
            display: flex;
            justify-content: space-between;
            gap: 0.5rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .option-label {
            flex: 1;
            text-align: center;
            padding: 0.5rem;
            background: #f8f9fa;
            border-radius: 6px;
            cursor: pointer;
            border: 2px solid transparent;
            min-width: 80px;
        }

        .option-label:hover {
            background: #e9ecef;
        }

        input[type="radio"] {
            display: none;
        }

        input[type="radio"]:checked+.option-label {
            border-color: var(--primary-color);
            background: rgba(52, 152, 219, 0.1);
            color: var(--primary-color);
            font-weight: bold;
        }

        .hidden {
            display: none;
        }
    </style>
</head>

<body>
    <header>
        <a href="../index.html" class="logo"><i class="fas fa-eye"></i> VisionHealth</a>
        <nav>
            <ul>
                <li><a href="../index.html">Home</a></li>
                <li><a href="index.html" class="active">Vision Tests</a></li>
                <li><a href="../innovations.html">Innovations</a></li>
            </ul>
        </nav>
    </header>

    <main class="container">
        <div id="intro-screen" class="test-container">
            <h2>Dry Eye Assessment (OSDI)</h2>
            <p>The Ocular Surface Disease Index (OSDI) is a valid and reliable instrument for measuring dry eye disease
                severity.</p>
            <p>Please answer the following 12 questions about your eyes <strong>over the last week</strong>.</p>
            <button id="start-btn" class="btn" style="margin-top: 1rem;">Start Questionnaire</button>
        </div>

        <div id="quiz-screen" class="test-container hidden">
            <form id="osdi-form">
                <!-- Questions injected via JS -->
            </form>
            <button id="submit-btn" class="btn" style="margin-top: 2rem;">Calculate Score</button>
        </div>

        <div id="result-screen" class="test-container hidden" style="text-align: center;">
            <h2>Assessment Complete</h2>
            <div id="score-circle"
                style="width: 150px; height: 150px; border-radius: 50%; border: 10px solid #ddd; margin: 2rem auto; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; font-weight: bold;">
                0
            </div>
            <h3 id="diagnosis-text">Normal</h3>
            <p id="diagnosis-desc"></p>
            <a href="index.html" class="btn-outline">Back to Tests</a>
        </div>
    </main>

    <script>
        const questions = [
            "1. Have you experienced eyes that are sensitive to light?",
            "2. Have you experienced eyes that feel gritty?",
            "3. Have you experienced painful or sore eyes?",
            "4. Have you experienced blurred vision?",
            "5. Have you experienced poor vision?",
            "6. Have you had problems reading?",
            "7. Have you had problems driving at night?",
            "8. Have you had problems working with a computer/ATM?",
            "9. Have you had problems watching TV?",
            "10. Have your eyes felt uncomfortable in windy conditions?",
            "11. Have your eyes felt uncomfortable in places with low humidity (dry air)?",
            "12. Have your eyes felt uncomfortable in air-conditioned areas?"
        ];

        const options = [
            { val: 4, text: "All of the time" },
            { val: 3, text: "Most of the time" },
            { val: 2, text: "Half of the time" },
            { val: 1, text: "Some of the time" },
            { val: 0, text: "None of the time" }
        ];

        const form = document.getElementById('osdi-form');

        // Generate Questions
        questions.forEach((q, idx) => {
            const div = document.createElement('div');
            div.className = 'question-card';
            div.innerHTML = `<h4>${q}</h4><div class="options-row"></div>`;

            const row = div.querySelector('.options-row');
            options.forEach(opt => {
                const id = `q${idx}_${opt.val}`;
                row.innerHTML += `
                    <input type="radio" name="q${idx}" id="${id}" value="${opt.val}">
                    <label class="option-label" for="${id}">${opt.text}</label>
                `;
            });
            form.appendChild(div);
        });

        document.getElementById('start-btn').addEventListener('click', () => {
            document.getElementById('intro-screen').classList.add('hidden');
            document.getElementById('quiz-screen').classList.remove('hidden');
        });

        document.getElementById('submit-btn').addEventListener('click', (e) => {
            e.preventDefault();
            calculateScore();
        });

        function calculateScore() {
            let sum = 0;
            let answeredCount = 0;

            for (let i = 0; i < questions.length; i++) {
                const selected = document.querySelector(`input[name="q${i}"]:checked`);
                if (selected) {
                    sum += parseInt(selected.value);
                    answeredCount++;
                }
            }

            if (answeredCount === 0) {
                alert("Please answer at least some questions.");
                return;
            }

            // OSDI Formula: (sum of scores x 25) / number of questions answered
            const score = (sum * 25) / answeredCount;
            showResult(score);
        }

        function showResult(score) {
            document.getElementById('quiz-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');

            const circle = document.getElementById('score-circle');
            const text = document.getElementById('diagnosis-text');
            const desc = document.getElementById('diagnosis-desc');

            circle.textContent = Math.round(score);

            if (score <= 12) {
                circle.style.borderColor = "#2ecc71";
                text.textContent = "Normal";
                text.style.color = "#2ecc71";
                desc.textContent = "Your eyes appear healthy with no significant signs of dry eye disease.";
            } else if (score <= 22) {
                circle.style.borderColor = "#f1c40f";
                text.textContent = "Mild Dry Eye";
                text.style.color = "#f1c40f";
                desc.textContent = "You may have mild dry eye symptoms. Consider using artificial tears.";
            } else if (score <= 32) {
                circle.style.borderColor = "#e67e22";
                text.textContent = "Moderate Dry Eye";
                text.style.color = "#e67e22";
                desc.textContent = "Your symptoms suggest moderate dry eye. Consult an eye care professional.";
            } else {
                circle.style.borderColor = "#e74c3c";
                text.textContent = "Severe Dry Eye";
                text.style.color = "#e74c3c";
                desc.textContent = "You have severe dry eye symptoms. Please see an ophthalmologist for treatment.";
            }
        }
    </script>
</body>

</html>
